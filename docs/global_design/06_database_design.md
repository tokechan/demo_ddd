# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ›¸

## ğŸ“¦ ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã‚«ãƒ©ãƒ ï¼ˆPK/FKä»˜ãï¼‰

### 1) accountsï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰

| **ã‚«ãƒ©ãƒ ** | **å‹** | **èª¬æ˜** |
|-----------|--------|----------|
| id (PK) | uuid | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |
| email | text | ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆ@å¿…é ˆï¼ãƒ¦ãƒ‹ãƒ¼ã‚¯ï¼‰ |
| first_name | text | åå‰ï¼ˆç©ºNGï¼‰ |
| last_name | text | è‹—å­—ï¼ˆç©ºNGï¼‰ |
| is_active | boolean | ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: trueï¼‰ |
| provider | text | èªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ï¼ˆä¾‹: googleï¼‰ |
| provider_account_id | text | ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å´ã®ID |
| thumbnail | text | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒURLï¼ˆnullableï¼‰ |
| last_login_at | timestamptz | æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³æ—¥æ™‚ï¼ˆnullableï¼‰ |
| created_at | timestamptz | ä½œæˆæ—¥æ™‚ |
| updated_at | timestamptz | æ›´æ–°æ—¥æ™‚ |

**ç´¢å¼•**ï¼š
- UNIQUE(email)
- UNIQUE(provider, provider_account_id)

### 2) templatesï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼‰

| **ã‚«ãƒ©ãƒ ** | **å‹** | **èª¬æ˜** |
|-----------|--------|----------|
| id (PK) | uuid | ãƒ†ãƒ³ãƒ—ãƒ¬ID |
| name | text | ãƒ†ãƒ³ãƒ—ãƒ¬åï¼ˆç©ºNGï¼‰ |
| owner_id (FKâ†’accounts.id) | uuid | ä½œæˆè€… |
| updated_at | timestamptz | æœ€çµ‚æ›´æ–° |

**é–¢ä¿‚**ï¼šaccounts 1 â”€< templates

### 3) fieldsï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ã®é …ç›®ï¼‰

| **ã‚«ãƒ©ãƒ ** | **å‹** | **èª¬æ˜** |
|-----------|--------|----------|
| id (PK) | uuid | ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ID |
| template_id (FKâ†’templates.id) | uuid | è¦ªãƒ†ãƒ³ãƒ—ãƒ¬ |
| label | text | é …ç›®åï¼ˆç©ºNGï¼‰ |
| order | int | è¡¨ç¤ºé †ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬å†…ã§é‡è¤‡NGï¼‰ |
| is_required | boolean | å¿…é ˆãªã‚‰true |

**åˆ¶ç´„ä¾‹**ï¼š
- UNIQUE(template_id, order)ï¼ˆé †ç•ªã®é‡è¤‡ã‚’é˜²ãï¼‰
- CHECK(order > 0)

**é–¢ä¿‚**ï¼štemplates 1 â”€< fields

### 4) notesï¼ˆãƒãƒ¼ãƒˆï¼‰

| **ã‚«ãƒ©ãƒ ** | **å‹** | **èª¬æ˜** |
|-----------|--------|----------|
| id (PK) | uuid | ãƒãƒ¼ãƒˆID |
| title | text | ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆç©ºNGï¼‰ |
| template_id (FKâ†’templates.id) | uuid | ä½¿ã£ãŸãƒ†ãƒ³ãƒ—ãƒ¬ |
| owner_id (FKâ†’accounts.id) | uuid | ä½œæˆè€… |
| status | text | Draft or Publishï¼ˆVOã§åˆ¶å¾¡ã—DBã¯TEXTã§ã‚‚OKï¼‰ |
| created_at | timestamptz | ä½œæˆæ—¥æ™‚ |
| updated_at | timestamptz | æ›´æ–°æ—¥æ™‚ |

**é–¢ä¿‚**ï¼š
- accounts 1 â”€< notes
- templates 1 â”€< notesï¼ˆã€Œå‚ç…§ã€ï¼šãƒ†ãƒ³ãƒ—ãƒ¬ã®å­˜åœ¨ãŒå¿…è¦ï¼‰

**ç´¢å¼•**ï¼šINDEX(owner_id), INDEX(template_id), INDEX(updated_at DESC)

### 5) sectionsï¼ˆãƒãƒ¼ãƒˆã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼šæœ¬æ–‡ã®å„ãƒ‘ãƒ¼ãƒˆï¼‰

| **ã‚«ãƒ©ãƒ ** | **å‹** | **èª¬æ˜** |
|-----------|--------|----------|
| id (PK) | uuid | ã‚»ã‚¯ã‚·ãƒ§ãƒ³ID |
| note_id (FKâ†’notes.id) | uuid | è¦ªãƒãƒ¼ãƒˆ |
| field_id (FKâ†’fields.id) | uuid | å¯¾å¿œã™ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬é …ç›® |
| content | text | å…¥åŠ›å†…å®¹ï¼ˆMVPã¯æ–‡å­—åˆ—ã®ã¿ï¼‰ |

**åˆ¶ç´„ä¾‹**ï¼š
- UNIQUE(note_id, field_id)ï¼ˆåŒã˜ãƒãƒ¼ãƒˆã§åŒã˜é …ç›®ã®é‡è¤‡ã‚’é˜²ãï¼‰
- å¿…é ˆé …ç›®ãƒã‚§ãƒƒã‚¯ã¯ã‚¢ãƒ—ãƒª/ãƒ‰ãƒ¡ã‚¤ãƒ³ã§å®Ÿæ–½ï¼ˆis_required ã‚’å‚ç…§ï¼‰

**é–¢ä¿‚**ï¼šnotes 1 â”€< sectionsï¼Œsections â†’ fieldsï¼ˆå¤šâ†’1å‚ç…§ï¼‰

**ç´¢å¼•**ï¼šINDEX(note_id), INDEX(field_id)

## ğŸ—ºï¸ ã¤ãªãŒã‚Šå›³ï¼ˆERãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ï¼šé–¢ä¿‚ï¼‰

```
accounts (ãƒ¦ãƒ¼ã‚¶ãƒ¼)
 â”œâ”€< templates (ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ)
 â”‚       â””â”€< fields (ãƒ†ãƒ³ãƒ—ãƒ¬ã®é …ç›®)
 â””â”€< notes (ãƒãƒ¼ãƒˆ)
         â””â”€< sections (ãƒãƒ¼ãƒˆã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³)
                 â””â”€â†’ fields (ã©ã®é …ç›®ã®ä¸­èº«ã‹å‚ç…§)
```

- A â”œâ”€< B â€¦ AãŒè¦ªã€BãŒå­ï¼ˆ1å¯¾å¤šï¼‰
- sections â””â”€â†’ fields â€¦ sections ã¯ **ã©ã® field ã®ä¸­èº«ã‹** ã‚’å‚ç…§ï¼ˆå¤šâ†’1ï¼‰

## ğŸ”’ é›†ç´„ã¨ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œ

### é›†ç´„å¢ƒç•Œã®å®šç¾©

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ä»¥ä¸‹ã®2ã¤ã®é›†ç´„ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

#### 1. Templateé›†ç´„ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒãƒ¼ãƒ ï¼‰

**é›†ç´„ãƒ«ãƒ¼ãƒˆ**: `templates`
**ãƒ¡ãƒ³ãƒãƒ¼**: `fields`

```
templates (é›†ç´„ãƒ«ãƒ¼ãƒˆ)
  â””â”€< fields (é›†ç´„ãƒ¡ãƒ³ãƒãƒ¼)
```

- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯å¸¸ã«ä¸€ç·’ã«æ‰±ã†
- ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è¿½åŠ ãƒ»æ›´æ–°ãƒ»å‰Šé™¤ã¯å¿…ãšãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é€šã—ã¦è¡Œã†
- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œ = Templateé›†ç´„

#### 2. Noteé›†ç´„ï¼ˆãƒãƒ¼ãƒˆãƒãƒ¼ãƒ ï¼‰

**é›†ç´„ãƒ«ãƒ¼ãƒˆ**: `notes`
**ãƒ¡ãƒ³ãƒãƒ¼**: `sections`
**å‚ç…§**: `templates` (é›†ç´„å¤–ã¸ã®å‚ç…§)

```
notes (é›†ç´„ãƒ«ãƒ¼ãƒˆ)
  â”œâ”€< sections (é›†ç´„ãƒ¡ãƒ³ãƒãƒ¼)
  â””â”€â†’ templates (å¤–éƒ¨é›†ç´„ã¸ã®å‚ç…§)
```

- ãƒãƒ¼ãƒˆã¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯å¸¸ã«ä¸€ç·’ã«æ‰±ã†
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¿½åŠ ãƒ»æ›´æ–°ãƒ»å‰Šé™¤ã¯å¿…ãšãƒãƒ¼ãƒˆã‚’é€šã—ã¦è¡Œã†
- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯å‚ç…§ã®ã¿ï¼ˆåˆ¥é›†ç´„ãªã®ã§æ›´æ–°ã—ãªã„ï¼‰
- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œ = Noteé›†ç´„

### ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³åˆ¶å¾¡ã®ãƒ«ãƒ¼ãƒ«

#### âœ… åŒä¸€é›†ç´„å†…ã®æ“ä½œï¼ˆ1ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ï¼‰

**Templateé›†ç´„ã®æ“ä½œä¾‹**:
1. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆ
2. ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ï¼ˆåŒã˜é›†ç´„å†…ï¼‰

ã“ã®2ã¤ã®æ“ä½œã¯1ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§å®Ÿè¡Œã—ã€æ•´åˆæ€§ã‚’ä¿è¨¼ã—ã¾ã™ã€‚

**Noteé›†ç´„ã®æ“ä½œä¾‹**:
1. ãƒãƒ¼ãƒˆä½œæˆ
2. ã‚»ã‚¯ã‚·ãƒ§ãƒ³ä½œæˆï¼ˆåŒã˜é›†ç´„å†…ï¼‰

ã“ã®2ã¤ã®æ“ä½œã¯1ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§å®Ÿè¡Œã—ã€æ•´åˆæ€§ã‚’ä¿è¨¼ã—ã¾ã™ã€‚

#### âš ï¸ é›†ç´„ã‚’ã¾ãŸãæ“ä½œï¼ˆåˆ¥ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ï¼‰

ç•°ãªã‚‹é›†ç´„ã¯åˆ¥ã€…ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã§æ“ä½œã—ã¾ã™ã€‚

**âŒ æ‚ªã„ä¾‹**: Templateé›†ç´„ã¨Noteé›†ç´„ã‚’1ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã§åŒæ™‚æ“ä½œ
- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆã¨ãƒãƒ¼ãƒˆä½œæˆã‚’åŒã˜ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã§å®Ÿè¡Œã™ã‚‹ã®ã¯NG

**âœ… è‰¯ã„ä¾‹**: é›†ç´„ã”ã¨ã«ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’åˆ†ã‘ã‚‹
1. Templateé›†ç´„ã®æ“ä½œï¼ˆãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³1ï¼‰
2. Noteé›†ç´„ã®æ“ä½œï¼ˆãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³2ã€Templateã¯å‚ç…§ã®ã¿ï¼‰

### é›†ç´„å¢ƒç•Œè¨­è¨ˆã®åŸå‰‡

1. **é›†ç´„å†…ã®æ•´åˆæ€§**
   - é›†ç´„ãƒ«ãƒ¼ãƒˆï¼ˆtemplates/notesï¼‰ã‚’é€šã—ã¦ã®ã¿æ›´æ–°
   - ãƒ¡ãƒ³ãƒãƒ¼ï¼ˆfields/sectionsï¼‰ã‚’ç›´æ¥æ›´æ–°ã—ãªã„

2. **é›†ç´„é–“ã®çµåˆåº¦**
   - ä»–ã®é›†ç´„ã¸ã®å‚ç…§ã¯ IDã®ã¿ï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰
   - é›†ç´„ã‚’ã¾ãŸãå‡¦ç†ã¯Serviceå±¤ã§èª¿æ•´

3. **ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ = é›†ç´„**
   - 1ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ = 1é›†ç´„ã®æ“ä½œ
   - è¤‡æ•°é›†ç´„ã«ã¾ãŸãŒã‚‹æ•´åˆæ€§ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã§ä¿è¨¼

4. **é›†ç´„ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ï¼ˆON DELETE CASCADEï¼‰**

   **å‹•ä½œ**:
   - Templateå‰Šé™¤æ™‚: `fields` ã‚‚è‡ªå‹•å‰Šé™¤ï¼ˆON DELETE CASCADEï¼‰
   - Noteå‰Šé™¤æ™‚: `sections` ã‚‚è‡ªå‹•å‰Šé™¤ï¼ˆON DELETE CASCADEï¼‰
   - é›†ç´„ãƒ«ãƒ¼ãƒˆã¨ä¸€ç·’ã«ãƒ¡ãƒ³ãƒãƒ¼ã‚‚å‰Šé™¤ã•ã‚Œã‚‹
   - Fieldå‰Šé™¤æ™‚: `sections` ã¯å‰Šé™¤ã•ã‚Œãªã„ï¼ˆå‚ç…§ã®ã¿ã€CASCADEè¨­å®šãªã—ï¼‰

   **é›†ç´„ã®å¢ƒç•Œ**:
   - `templates` â‡„ `fields`: åŒã˜é›†ç´„ï¼ˆè¦ªå­é–¢ä¿‚ã€CASCADEï¼‰
   - `notes` â‡„ `sections`: åŒã˜é›†ç´„ï¼ˆè¦ªå­é–¢ä¿‚ã€CASCADEï¼‰
   - `sections` â†’ `fields`: é›†ç´„ã‚’ã¾ãŸãå‚ç…§ï¼ˆCASCADEãªã—ï¼‰

### ON DELETE CASCADEã®ä½¿ã„åˆ†ã‘

| é–¢ä¿‚ | CASCADEè¨­å®š | ç†ç”± |
|-----|-----------|------|
| `templates` â†’ `fields` | ã‚ã‚Š | åŒä¸€é›†ç´„ã€‚ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‰Šé™¤æ™‚ã«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚‚å‰Šé™¤ |
| `notes` â†’ `sections` | ã‚ã‚Š | åŒä¸€é›†ç´„ã€‚ãƒãƒ¼ãƒˆå‰Šé™¤æ™‚ã«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚‚å‰Šé™¤ |
| `sections` â†’ `fields` | ãªã— | é›†ç´„ã‚’ã¾ãŸãå‚ç…§ã€‚ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å‰Šé™¤æ™‚ã«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯æ®‹ã™ï¼ˆå‚ç…§æ•´åˆæ€§ã®ã¿ï¼‰ |
| `templates` â†’ `notes` | ãªã— | é›†ç´„ã‚’ã¾ãŸãå‚ç…§ã€‚ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‰Šé™¤æ™‚ã«ãƒãƒ¼ãƒˆã¯æ®‹ã™ï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ï¼‰ |
| `accounts` â†’ `templates` | ãªã— | é›†ç´„ã‚’ã¾ãŸãå‚ç…§ã€‚ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤æ™‚ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã§åˆ¶å¾¡ |
| `accounts` â†’ `notes` | ãªã— | é›†ç´„ã‚’ã¾ãŸãå‚ç…§ã€‚ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤æ™‚ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã§åˆ¶å¾¡ |

**åŸå‰‡**:
- **åŒä¸€é›†ç´„å†…ã®è¦ªå­é–¢ä¿‚**: ON DELETE CASCADE ã‚’ä½¿ç”¨
- **é›†ç´„ã‚’ã¾ãŸãå‚ç…§**: CASCADE ãªã—ï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã§åˆ¶å¾¡ï¼‰