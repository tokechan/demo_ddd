# 📚 Clean Architecture ドキュメント - 学習ガイド

このディレクトリには、**Clean Architecture を初心者向けにわかりやすく解説したドキュメント**があります。

## 🎯 このドキュメントの目的

- クリーンアーキテクチャをゼロから理解する
- なぜ必要なのか腑に落ちる
- 実際の処理の流れを理解する
- テストの書き方を学ぶ

---

## 🤖 なぜ今、クリーンアーキテクチャを学ぶべきか？

### 1. **AI時代の開発スタイルに最適**

```
❌ グチャグチャなコード（backend-bad）:
「この機能を追加して」
  ↓
AI「どこに書けばいいかわからない...」
AI「既存のコードが複雑すぎる...」
AI「バグを埋め込んでしまうかも...」
  ↓
👉 結局、手動で修正が必要（AI使えない）


✅ クリーンアーキテクチャ（backend-clean）:
「ユーザー認証機能を追加して」
  ↓
AI「はい！ドメイン層に認証ロジックを追加します」
AI「UseCaseに認証チェックを追加します」
AI「Repositoryにユーザー取得機能を追加します」
  ↓
👉 AIが正確に、正しい場所に、適切なコードを生成！
```

**なぜ？**
- **構造が明確** → AIが「どこに何を書くべきか」を理解しやすい
- **責務が分離** → AIが「この機能はこの層」と判断しやすい
- **パターンが統一** → AIが「同じパターンで書けばいい」と学習しやすい

---

### 2. **保守性・可読性・再利用性が圧倒的に高い**

```
保守性（Maintainability）:
├─ 各層が独立 → 影響範囲が限定的
├─ テストが充実 → 安心して変更できる
└─ ルールが集約 → 「どこを変えればいいか」が明確

可読性（Readability）:
├─ 各ファイルが短い（10-30行） → スクロールなしで全体が見える
├─ 責務が明確 → 「このファイルは何をするか」が一目瞭然
└─ 手順書みたい → コメントなしでも理解できる

再利用性（Reusability）:
├─ ドメインロジックが独立 → 別のプロジェクトでも使える
├─ Interfaceで抽象化 → PostgreSQL→MySQLの切り替えが簡単
└─ 層ごとにテスト可能 → 安心して再利用できる
```

---

### 3. **運用に強い（仕様変更・機能追加・ライブラリ変更）**

#### 📌 シナリオ1: 仕様変更（API設計変更）
```
例: フィールド名を変更したい

❌ backend-bad:
- 影響範囲: 全ファイル（50箇所以上）
- 所要時間: 半日
- バグリスク: 高（修正漏れの可能性）

✅ backend-clean:
- 影響範囲: Controllerの変換処理のみ（1箇所）
- 所要時間: 5分
- バグリスク: 低（ドメイン層は一切変更なし）
```

#### 📌 シナリオ2: 機能追加（新機能を追加）
```
例: タグ機能を追加したい

❌ backend-bad:
- どこに書けばいいかわからない
- 既存のコードを読み解く必要がある（1時間）
- 100行の関数に追加 → さらに複雑化

✅ backend-clean:
1. Domain層にタグのエンティティとロジックを追加（10分）
2. UseCaseにタグ操作を追加（15分）
3. Repositoryにタグ保存機能を追加（10分）
   → 合計: 35分、影響範囲が明確、AIでも生成可能
```

#### 📌 シナリオ3: ライブラリ変更（PostgreSQL → MySQL）
```
❌ backend-bad:
- Service層に直接PostgreSQLのコードが埋まってる
- 全ファイルを書き換え（数日）
- バグ多発

✅ backend-clean:
- Repositoryの実装を変えるだけ（1日）
- UseCase層は一切変更なし
- インターフェースで抽象化されてるから安心
```

---

### 🎯 まとめ: クリーンアーキテクチャは「未来への投資」

```
短期的には:
  ちょっと面倒（層を分ける、変換処理を書く）

長期的には:
  ✅ AI がコードを生成しやすい（AIペアプロが捗る）
  ✅ 新メンバーがすぐ理解できる（可読性が高い）
  ✅ 仕様変更に強い（影響範囲が限定的）
  ✅ 機能追加が速い（どこに書くか明確）
  ✅ ライブラリ変更が楽（Interfaceで抽象化）
  ✅ テストが充実（安心して変更できる）

結果:
  👉 開発が楽しい、チームが幸せ、プロダクトが成長し続ける
```

**これからの時代、クリーンアーキテクチャは「できれば」ではなく「必須」のスキルです。**

## 📖 学習順序（この順番で読んでください）

### 1️⃣ [01_why_clean_architecture.md](./01_why_clean_architecture.md)
**「なぜクリーンアーキテクチャが必要？」- 動機づけ**

```
📌 こんな人におすすめ:
- 「クリーンアーキテクチャって面倒くさそう...」と思ってる人
- 「なんでわざわざ層を分けるの？」と疑問に思ってる人

📝 学べること:
- backend-bad（アンチパターン）の9つの問題
  1. ドメイン層がない → ジェンガ崩壊
  2. Serviceが何でも屋 → 100行関数
  3. DBを直接呼ぶ → テスト不能
  4. if文地獄 → 迷路
  5-9. その他の問題まとめ
- backend-cleanでの解決策（簡潔に）
- 開発速度の変化グラフ（負のスパイラル vs 正のスパイラル）
- コスト比較（長期的には圧倒的にお得）

⏱️ 読む時間: 15分（コンパクト化！）
```

---

### 2️⃣ [02_clean_architecture_guide.md](./02_clean_architecture_guide.md)
**「クリーンアーキテクチャの完全ガイド」- 処理の流れと全体像**

```
📌 こんな人におすすめ:
- 「実際にどう動くの？」を知りたい人
- リクエストがどう処理されるか追いたい人
- 有名な同心円図の意味を理解したい人

📝 学べること:
- 有名な同心円図の解説
- 学校の比喩で理解する（受付→事務室→校則→倉庫→掲示板）
- 実際のリクエストフロー（GET /api/notes/123）
- Interface とは？（レストランのメニューの比喩）
- Factory とは？（おもちゃ工場の比喩）
- メソッドの呼び出し連鎖
- FAQ（よくある質問）
- チェックリスト（コードを書く前に確認）
- ディレクトリ構成の詳細

⏱️ 読む時間: 50分
```

---

### 3️⃣ [03_testing_guide.md](./03_testing_guide.md) ※オプション
**「テストの書き方」- backend-badとの比較**

```
📌 こんな人におすすめ:
- 「テストって難しそう...」と思ってる人
- 実際にテストを書きたい人
- Mock（モック）の使い方を知りたい人

📝 学べること:
- backend-badのテスト問題（DB必須、遅い、書けない）
- backend-cleanのテスト解決策（モック、速い、簡単）
- レイヤー別テストガイド
  1. Domain層（backend-badはドメイン層がない）
  2. UseCase層（モックを使う）
- 実際のテストコード例（テーブル駆動テスト）

⏱️ 読む時間: 30分
```

---

### 4️⃣ [04_ai_driven_development.md](./04_ai_driven_development.md) ※推奨
**「AI駆動開発ガイド」- このドキュメントを使ってAIに実装させよう**

```
📌 こんな人におすすめ:
- 「AIに実装を任せたい」と思ってる人
- AI駆動開発を体験したい人
- 13倍速く開発したい人

📝 学べること:
- AIにドキュメントを読み込ませる方法
- AIへの指示の出し方（「タグ機能追加して」）
- AIが生成するコード例（全層 + テストコード）
- C1カバレッジ達成レベルのテスト生成
- backend-bad vs backend-clean でのAI駆動開発の違い
  - backend-bad: AIが混乱、バグだらけ、手動修正2時間
  - backend-clean: AIが正確、高品質、レビューのみ30分

⏱️ 読む時間: 20分
```

---

### 5️⃣ [05_local_setup.md](./05_local_setup.md) ※実践用
**「ローカル環境セットアップガイド」- backend-cleanをローカルで動かす**

```
📌 こんな人におすすめ:
- 実際にコードを動かしたい人
- ローカル開発環境を構築したい人
- Docker、マイグレーション、テストを実行したい人

📝 学べること:
- Docker Composeでの環境構築
- OpenAPI生成（TypeSpec → OpenAPI YAML → Goコード）
- データベースマイグレーション実行
- 動作確認（curl、テスト実行）
- よく使うコマンド一覧
- トラブルシューティング

⏱️ 読む時間: 15分
```

---

## 🚀 学習の進め方（推奨）

```
ステップ1: 動機づけ（15分）
  └─ 01_why_clean_architecture.md を読む
     「あ、これやらないとヤバいんだ！」と腑に落ちる

ステップ2: 処理の流れと全体像を理解（50分）
  └─ 02_clean_architecture_guide.md を読む
     同心円図、リクエストフロー、FAQ、チェックリストを理解する

ステップ3: 実際のコードを読む（自由）
  └─ backend-clean/ のコードを読む
     ドキュメントで学んだことを確認する

ステップ4: テストを書いてみる（オプション）
  └─ 03_testing_guide.md を読む
     backend-badとの比較でテストの重要性を理解する

ステップ5: AI駆動開発を試してみる（推奨）
  └─ 04_ai_driven_development.md を読む
     AIにこのドキュメントを読ませて実装させてみる

ステップ6: ローカル環境で動かしてみる（実践）
  └─ 05_local_setup.md を読む
     Docker Compose、マイグレーション、テストを実行
```

---

## 💡 ドキュメントの特徴

- **小学生でも理解できるレベル** - 専門用語は比喩で説明
- **図解が豊富** - ASCIIアートで視覚的に理解
- **具体例がたくさん** - 実際のコードを使って説明
- **Before/After がわかる** - backend-bad と backend-clean の比較

---

## 🔗 関連ファイル

- **backend-bad/** - アンチパターンのコード（教材用）
- **backend-clean/** - クリーンアーキテクチャのコード（このプロジェクト）

---

## 📞 フィードバック

- わかりにくい箇所があれば Issue を立ててください
- 改善案があれば PR を送ってください

---

**💪 さあ、クリーンアーキテクチャをマスターしよう！**
