# ğŸ¯ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å‡¦ç†ã®æµã‚Œ - å°å­¦ç”Ÿã§ã‚‚ã‚ã‹ã‚‹å®Œå…¨ã‚¬ã‚¤ãƒ‰

ã“ã®å›³ã€è¦‹ãŸã“ã¨ã‚ã‚Šã¾ã™ã‹ï¼Ÿ

![Clean Architecture](https://blog.cleancoder.com/uncle-bob/images/2012-08-13-the-clean-architecture/CleanArchitecture.jpg)

**ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§æœ€ã‚‚æœ‰åãªã€ŒåŒå¿ƒå††ã®å›³ã€**ã§ã™ã€‚

ã§ã‚‚ã€**ã€Œã“ã‚Œã€å®Ÿéš›ã©ã†å‹•ãã®ï¼Ÿã€**ã£ã¦æ€ã„ã¾ã›ã‚“ã‹ï¼Ÿ

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€ã“ã®å›³ã‚’ä½¿ã£ã¦ã€**å°å­¦ç”Ÿã§ã‚‚ã‚ã‹ã‚‹ãƒ¬ãƒ™ãƒ«**ã§å‡¦ç†ã®æµã‚Œã‚’è§£èª¬ã—ã¾ã™ã€‚

---

## ğŸ“š ç›®æ¬¡

1. [åŒå¿ƒå††ã®å›³ã£ã¦ä½•ï¼Ÿ](#åŒå¿ƒå††ã®å›³ã£ã¦ä½•)
2. [ä¾‹ãˆè©±: å­¦æ ¡ã§ç†è§£ã™ã‚‹](#ä¾‹ãˆè©±-å­¦æ ¡ã§ç†è§£ã™ã‚‹)
3. [ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã£ã¦ä½•ï¼Ÿ](#ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã£ã¦ä½•)
4. [å®Ÿéš›ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æµã‚Œ](#å®Ÿéš›ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æµã‚Œ)
5. [Factoryã£ã¦ä½•ï¼Ÿ](#factoryã£ã¦ä½•)
6. [ã©ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒã©ã“ã‚’å‘¼ã¶ã®ã‹](#ã©ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒã©ã“ã‚’å‘¼ã¶ã®ã‹)

---

## åŒå¿ƒå††ã®å›³ã£ã¦ä½•ï¼Ÿ

```
        ğŸ¯ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®åŒå¿ƒå††

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   å¤–å´: Frameworks & Drivers        â”‚  â† DBã€Webã€å¤–éƒ¨ãƒ„ãƒ¼ãƒ«
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚  ä¸­: Interface Adapters       â”‚  â”‚  â† Controllerã€Gatewayã€Presenter
    â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
    â”‚  â”‚ â”‚ å†…: Application Logic   â”‚   â”‚  â”‚  â† UseCase
    â”‚  â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚  â”‚
    â”‚  â”‚ â”‚ â”‚ ä¸­å¿ƒ: Entities    â”‚   â”‚   â”‚  â”‚  â† Domain
    â”‚  â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚  â”‚
    â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é‡è¦ãªãƒ«ãƒ¼ãƒ«:
çŸ¢å°ã¯ã€Œå†…å´ã«å‘ã‹ã£ã¦ã®ã¿ã€è¨±å¯ã•ã‚Œã‚‹
å¤–å´ã¯å†…å´ã‚’çŸ¥ã£ã¦OKã€å†…å´ã¯å¤–å´ã‚’çŸ¥ã£ã¡ã‚ƒãƒ€ãƒ¡
```

### å„å±¤ã®å½¹å‰²

| å±¤ | ä½•ã‚’ã™ã‚‹ï¼Ÿ | ä¾‹ |
|----|-----------|-----|
| **Entitiesï¼ˆä¸­å¿ƒï¼‰** | ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ« | ã€Œãƒãƒ¼ãƒˆã¯å…¬é–‹å‰ã«å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’åŸ‹ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹ã€ |
| **Use Casesï¼ˆå†…å´ï¼‰** | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ‰‹é † | ã€Œ1. ãƒãƒ¼ãƒˆå–å¾— 2. æ¤œè¨¼ 3. ä¿å­˜ 4. é€šçŸ¥ã€ |
| **Interface Adaptersï¼ˆä¸­é–“ï¼‰** | å¤‰æ› | ã€ŒHTTP â†’ Domainå‹ã€ã€ŒDomainå‹ â†’ DBå‹ã€ |
| **Frameworks & Driversï¼ˆå¤–å´ï¼‰** | å¤–éƒ¨ãƒ„ãƒ¼ãƒ« | PostgreSQLã€Echoã€OpenAPI |

---

## ä¾‹ãˆè©±: å­¦æ ¡ã§ç†è§£ã™ã‚‹

ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’**å­¦æ ¡**ã§ä¾‹ãˆã¾ã™ã€‚

### ğŸ« å­¦æ ¡ã®çµ„ç¹”å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ğŸ« å­¦æ ¡                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  ğŸ“ å—ä»˜ï¼ˆControllerï¼‰                       â”‚
â”‚    â†“ ã€Œä¿è­·è€…ã‹ã‚‰é›»è©±ãŒæ¥ãŸã€                â”‚
â”‚                                             â”‚
â”‚  ğŸ“‹ äº‹å‹™å®¤ï¼ˆUseCaseï¼‰                        â”‚
â”‚    â†“ ã€Œã©ã†å¯¾å¿œã™ã‚‹ã‹æ±ºã‚ã‚‹ã€                â”‚
â”‚                                             â”‚
â”‚  ğŸ“– æ ¡å‰‡ï¼ˆDomain/ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ï¼‰            â”‚
â”‚    â†“ ã€Œä½•ãŒè¨±ã•ã‚Œã‚‹ã‹ã€                      â”‚
â”‚                                             â”‚
â”‚  ğŸ—‚ï¸ å€‰åº«ï¼ˆRepository/DBï¼‰                   â”‚
â”‚    ã€Œç”Ÿå¾’ã®æƒ…å ±ã‚’ä¿ç®¡ã€                      â”‚
â”‚                                             â”‚
â”‚  ğŸ“£ æ²ç¤ºæ¿ï¼ˆPresenterï¼‰                      â”‚
â”‚    ã€Œçµæœã‚’ä¿è­·è€…ã«ä¼ãˆã‚‹å½¢å¼ã«æ•´ãˆã‚‹ã€      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚·ãƒŠãƒªã‚ª: ã€Œç”Ÿå¾’ã®æˆç¸¾ã‚’è¦‹ãŸã„ã€

1. **ğŸ“ å—ä»˜ï¼ˆControllerï¼‰ãŒé›»è©±ã‚’å—ã‘ã‚‹**
   ```
   ä¿è­·è€…: ã€Œã†ã¡ã®å­ã®æˆç¸¾ã‚’æ•™ãˆã¦ãã ã•ã„ã€
   å—ä»˜: ã€Œã¯ã„ã€å°‘ã€…ãŠå¾…ã¡ãã ã•ã„ã€
   ```

2. **ğŸ“‹ äº‹å‹™å®¤ï¼ˆUseCaseï¼‰ãŒå¯¾å¿œã‚’æ±ºã‚ã‚‹**
   ```
   äº‹å‹™å®¤: ã€Œã“ã®ä¿è­·è€…ã¯èª°ã®è¦ªï¼Ÿã€
   äº‹å‹™å®¤: ã€Œæ ¡å‰‡ã§ç¢ºèªã§ãã‚‹ï¼Ÿã€ â†’ ğŸ“– æ ¡å‰‡ã‚’ãƒã‚§ãƒƒã‚¯
   äº‹å‹™å®¤: ã€Œæˆç¸¾ã‚’å–ã£ã¦ãã¦ã€ â†’ ğŸ—‚ï¸ å€‰åº«ã«ä¾é ¼
   ```

3. **ğŸ“– æ ¡å‰‡ï¼ˆDomainï¼‰ã‚’ãƒã‚§ãƒƒã‚¯**
   ```
   æ ¡å‰‡: ã€Œä¿è­·è€…ã¯è‡ªåˆ†ã®å­ã®æˆç¸¾ã ã‘è¦‹ã‚Œã‚‹ã€
   æ ¡å‰‡: ã€Œä»–äººã®å­ã®æˆç¸¾ã¯è¦‹ã‚Œãªã„ã€
   ```

4. **ğŸ—‚ï¸ å€‰åº«ï¼ˆRepositoryï¼‰ãŒæƒ…å ±ã‚’å–å¾—**
   ```
   å€‰åº«: ã€Œç”Ÿå¾’ID=123ã®æˆç¸¾ã‚’æ¢ã™ã€
   å€‰åº«: ã€Œè¦‹ã¤ã‘ãŸï¼å›½èª90ç‚¹ã€ç®—æ•°85ç‚¹ã€
   ```

5. **ğŸ“‹ äº‹å‹™å®¤ï¼ˆUseCaseï¼‰ãŒæ²ç¤ºæ¿ã«æ¸¡ã™**
   ```
   äº‹å‹™å®¤: ã€Œã“ã®æˆç¸¾ã‚’ä¿è­·è€…ã«ä¼ãˆã‚‰ã‚Œã‚‹å½¢ã«ã—ã¦ã€
   ```

6. **ğŸ“£ æ²ç¤ºæ¿ï¼ˆPresenterï¼‰ãŒæ•´å½¢**
   ```
   æ²ç¤ºæ¿: ã€Œå›½èª: 90ç‚¹ã€ç®—æ•°: 85ç‚¹ã€
   æ²ç¤ºæ¿: ã€Œä¿è­·è€…ã«ã‚ã‹ã‚Šã‚„ã™ã„å½¢å¼ã§æº–å‚™å®Œäº†ã€
   ```

7. **ğŸ“ å—ä»˜ï¼ˆControllerï¼‰ãŒä¼ãˆã‚‹**
   ```
   å—ä»˜: ã€ŒãŠå¾…ãŸã›ã—ã¾ã—ãŸã€‚ãŠå­æ§˜ã®æˆç¸¾ã¯...ã€
   ```

### ãƒã‚¤ãƒ³ãƒˆ

```
âœ… å—ä»˜ï¼ˆControllerï¼‰ã¯æ ¡å‰‡ï¼ˆDomainï¼‰ã‚’çŸ¥ã‚‰ãªã„
   â†’ äº‹å‹™å®¤ï¼ˆUseCaseï¼‰ã«ä¸¸æŠ•ã’

âœ… æ ¡å‰‡ï¼ˆDomainï¼‰ã¯é›»è©±ã®ã“ã¨ã‚’çŸ¥ã‚‰ãªã„
   â†’ ç´”ç²‹ãªãƒ«ãƒ¼ãƒ«ã ã‘

âœ… å€‰åº«ï¼ˆRepositoryï¼‰ã¯æ ¡å‰‡ã«å¾“ã£ã¦å‹•ã
   â†’ ã€Œèª°ã§ã‚‚è¦‹ã‚Œã‚‹ã€ã˜ã‚ƒãªãã¦ã€Œä¿è­·è€…ã ã‘ã€

âœ… ãã‚Œãã‚Œã®å½¹å‰²ãŒæ˜ç¢º
   â†’ å—ä»˜ãŒå€‰åº«ã‚’ç›´æ¥è¦‹ã«è¡Œã‹ãªã„
```

---

## ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã£ã¦ä½•ï¼Ÿ

ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯**ã€Œç´„æŸäº‹ã€**ã§ã™ã€‚

### ğŸ¤ ä¾‹ãˆ: ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ğŸ“‹ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆInterfaceï¼‰ â”‚
â”‚                             â”‚
â”‚  - ãƒ”ã‚¶ã‚’ç„¼ã                â”‚
â”‚  - ãƒ‘ã‚¹ã‚¿ã‚’ä½œã‚‹              â”‚
â”‚  - ã‚µãƒ©ãƒ€ã‚’ç››ã‚‹              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘ ã€Œã“ã†ã„ã†æ–™ç†ã‚’æä¾›ã™ã‚‹ã€ã¨ã„ã†ç´„æŸ
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â”‚          â”‚
ã‚¤ã‚¿ãƒªã‚¢äºº    æ—¥æœ¬äºº
ã‚·ã‚§ãƒ•        ã‚·ã‚§ãƒ•
```

**ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆInterfaceï¼‰ãŒã‚ã‚Œã°:**
- ãŠå®¢ã•ã‚“ã¯ã€Œèª°ãŒä½œã‚‹ã‹ã€ã‚’æ°—ã«ã—ãªãã¦ã„ã„
- ã‚·ã‚§ãƒ•ã‚’äº¤ä»£ã—ã¦ã‚‚ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒåŒã˜ãªã‚‰OK
- æ–°äººã‚·ã‚§ãƒ•ã§ã‚‚ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼é€šã‚Šä½œã‚Œã°OK

### ğŸ’» ã‚³ãƒ¼ãƒ‰ã§è¦‹ã‚‹

```go
// ğŸ“‹ ã“ã‚ŒãŒã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆç´„æŸäº‹ï¼‰
type NoteRepository interface {
    Get(ctx context.Context, id string) (*note.Note, error)
    Create(ctx context.Context, n note.Note) error
    Delete(ctx context.Context, id string) error
}

// ğŸ‘¨â€ğŸ³ ã“ã‚ŒãŒå®Ÿè£…ãã®1ï¼ˆPostgreSQLã‚·ã‚§ãƒ•ï¼‰
type PostgresNoteRepository struct {
    pool *pgxpool.Pool
}

func (r *PostgresNoteRepository) Get(ctx context.Context, id string) (*note.Note, error) {
    // PostgreSQLã‹ã‚‰å–å¾—
    row, err := r.pool.QueryRow(ctx, "SELECT * FROM notes WHERE id = $1", id)
    // ...
}

// ğŸ‘¨â€ğŸ³ ã“ã‚ŒãŒå®Ÿè£…ãã®2ï¼ˆMySQLã‚·ã‚§ãƒ•ï¼‰
type MySQLNoteRepository struct {
    db *sql.DB
}

func (r *MySQLNoteRepository) Get(ctx context.Context, id string) (*note.Note, error) {
    // MySQLã‹ã‚‰å–å¾—
    row, err := r.db.QueryRowContext(ctx, "SELECT * FROM notes WHERE id = ?", id)
    // ...
}

// ğŸ‘¨â€ğŸ³ ã“ã‚ŒãŒå®Ÿè£…ãã®3ï¼ˆãƒ†ã‚¹ãƒˆç”¨ã®å½ç‰©ã‚·ã‚§ãƒ•ï¼‰
type MockNoteRepository struct {
    notes map[string]*note.Note
}

func (r *MockNoteRepository) Get(ctx context.Context, id string) (*note.Note, error) {
    // ãƒ¡ãƒ¢ãƒªã‹ã‚‰å–å¾—ï¼ˆDBã‚¢ã‚¯ã‚»ã‚¹ãªã—ï¼‰
    return r.notes[id], nil
}
```

**UseCaseã¯ã©ã‚Œã‚’ä½¿ã£ã¦ã‚‹ï¼Ÿ**

```go
type NoteInteractor struct {
    repo NoteRepository  // â† ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆç´„æŸäº‹ï¼‰ã ã‘çŸ¥ã£ã¦ã‚‹
}

func (u *NoteInteractor) Get(ctx context.Context, id string) error {
    // ã©ã®ã‚·ã‚§ãƒ•ãŒä½œã£ã¦ã‚‹ã‹çŸ¥ã‚‰ãªã„ï¼
    // ã§ã‚‚ç´„æŸé€šã‚Šã«æ–™ç†ï¼ˆãƒ‡ãƒ¼ã‚¿ï¼‰ãŒå‡ºã¦ãã‚‹
    note, err := u.repo.Get(ctx, id)
    // ...
}
```

**ã“ã‚ŒãŒã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®åŠ›ï¼**

```
âœ… PostgreSQL â†’ MySQLã«å¤‰æ›´ã—ã¦ã‚‚ã€UseCaseã¯å¤‰æ›´ä¸è¦
âœ… ãƒ†ã‚¹ãƒˆæ™‚ã¯Mockã‚’ä½¿ãˆã‚‹ï¼ˆDBèµ·å‹•ä¸è¦ï¼‰
âœ… æ–°ã—ã„DBè¿½åŠ ã‚‚ç°¡å˜ï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®Ÿè£…ã™ã‚‹ã ã‘ï¼‰
```

---

## å®Ÿéš›ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æµã‚Œ

ã§ã¯ã€å®Ÿéš›ã« **GET /api/notes/123** ã¨ã„ã†ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ¥ãŸã‚‰ä½•ãŒèµ·ã“ã‚‹ã‹ã€è©³ã—ãè¦‹ã¦ã„ãã¾ã™ã€‚

### ğŸš€ å…¨ä½“ã®æµã‚Œ

```
ğŸŒ ãƒ¦ãƒ¼ã‚¶ãƒ¼
    â”‚
    â”‚ GET /api/notes/123
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â‘  Echo (Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯)              â”‚  â† å¤–å´: Framework
â”‚     ã€Œãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ¥ãŸï¼Controllerã¸ã€   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â‘¡ Controller (å—ä»˜çª“å£)                 â”‚  â† ä¸­é–“: Interface Adapter
â”‚     ã€ŒID=123ã®ãƒãƒ¼ãƒˆæ¬²ã—ã„ã£ã¦ã€         â”‚
â”‚     ã€ŒUseCaseã«é ¼ã‚‚ã†ã€                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ input.Get(ctx, "123")
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â‘¢ UseCase (äº‹å‹™å®¤)                      â”‚  â† å†…å´: Application Logic
â”‚     ã€Œ1. Repositoryã«å–å¾—ä¾é ¼ã€          â”‚
â”‚     ã€Œ2. Presenterã«æ¸¡ã™ã€               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                           â†‘
    â”‚ Get("123")                â”‚ å–å¾—ã—ãŸNote
    â†“                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â‘£ Repository (å€‰åº«)                     â”‚  â† ä¸­é–“: Interface Adapter
â”‚     ã€ŒDBã‹ã‚‰å–å¾—ã—ã¾ã™ã€                 â”‚
â”‚     ã€ŒDBå‹ â†’ Domainå‹ã«å¤‰æ›ã€            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ SELECT * FROM notes WHERE id = '123'
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â‘¤ PostgreSQL (ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹)            â”‚  â† å¤–å´: Framework
â”‚     ã€Œãƒ‡ãƒ¼ã‚¿è¿”ã™ã‚ˆã€                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ Row{id, title, ...}
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â‘¥ Repository (å€‰åº«)                     â”‚
â”‚     ã€Œpgx.Row â†’ note.Note ã«å¤‰æ›ã€       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ note.Note
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â‘¦ UseCase (äº‹å‹™å®¤)                      â”‚
â”‚     ã€ŒPresenterã«æ¸¡ã™ã€                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ PresentNote(note)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â‘§ Presenter (æ²ç¤ºæ¿)                    â”‚  â† ä¸­é–“: Interface Adapter
â”‚     ã€Œnote.Note â†’ OpenAPIå‹ã«å¤‰æ›ã€      â”‚
â”‚     ã€Œçµæœã‚’ä¿å­˜ã€                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â‘¨ Controller (å—ä»˜çª“å£)                 â”‚
â”‚     ã€ŒPresenterã‹ã‚‰çµæœã‚’å–ã‚Šå‡ºã™ã€      â”‚
â”‚     ã€ŒHTTPãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦è¿”ã™ã€         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ HTTP 200 OK + JSON
    â†“
ğŸŒ ãƒ¦ãƒ¼ã‚¶ãƒ¼
```

### ğŸ“ ã‚³ãƒ¼ãƒ‰ã§è¦‹ã‚‹ï¼ˆæŠœç²‹ï¼‰

#### â‘  Echo â†’ Controller

```go
// Echo ãŒè‡ªå‹•ã§ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
// GET /api/notes/:id â†’ NoteController.GetByID ã‚’å‘¼ã¶
```

#### â‘¡ Controller

```go
// internal/adapter/http/controller/note_controller.go
func (c *NoteController) GetByID(ctx echo.Context, noteID string) error {
    // 1. FactoryçµŒç”±ã§UseCaseã¨Presenterã‚’ä½œã‚‹
    input, p := c.newIO()

    // 2. UseCaseã‚’å‘¼ã¶ï¼ˆè©³ç´°ã¯çŸ¥ã‚‰ãªã„ã€ä¸¸æŠ•ã’ï¼‰
    if err := input.Get(ctx.Request().Context(), noteID); err != nil {
        return handleError(ctx, err)
    }

    // 3. Presenterã‹ã‚‰çµæœã‚’å–å¾—
    return ctx.JSON(http.StatusOK, p.Note())
}

func (c *NoteController) newIO() (port.NoteInputPort, *presenter.NotePresenter) {
    // Factoryã‚’å‘¼ã‚“ã§æ–°ã—ã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œã‚‹ï¼ˆå¾Œã§è©³ã—ãèª¬æ˜ï¼‰
    output := c.outputFactory()
    input := c.inputFactory(c.noteRepoFactory(), c.tplRepoFactory(), c.txFactory(), output)
    return input, output
}
```

#### â‘¢ UseCase

```go
// internal/usecase/note_interactor.go
func (u *NoteInteractor) Get(ctx context.Context, id string) error {
    // 1. Repositoryã«å–å¾—ä¾é ¼ï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹çµŒç”±ï¼‰
    n, err := u.notes.Get(ctx, id)
    if err != nil {
        return err
    }

    // 2. Presenterã«æ¸¡ã™ï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹çµŒç”±ï¼‰
    return u.output.PresentNote(ctx, n)
}
```

#### â‘£ Repository

```go
// internal/adapter/gateway/db/sqlc/note_repository.go
func (r *NoteRepository) Get(ctx context.Context, id string) (*note.WithMeta, error) {
    // 1. string â†’ pgtype.UUID ã«å¤‰æ›
    pgID, err := toUUID(id)
    if err != nil {
        return nil, err
    }

    // 2. sqlc ã§DBå•ã„åˆã‚ã›
    row, err := queriesForContext(ctx, r.queries).GetNoteByID(ctx, pgID)
    if err != nil {
        if errors.Is(err, pgx.ErrNoRows) {
            return nil, domainerr.ErrNotFound  // DBã‚¨ãƒ©ãƒ¼ â†’ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼ã«å¤‰æ›
        }
        return nil, err
    }

    // 3. Sectionså–å¾—
    sections, err := r.listSections(ctx, row.ID)
    if err != nil {
        return nil, err
    }

    // 4. DBè¡Œ â†’ ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã«å¤‰æ›
    return &note.WithMeta{
        Note: note.Note{
            ID:         uuidToString(row.ID),       // pgtype.UUID â†’ string
            Title:      row.Title,
            TemplateID: uuidToString(row.TemplateID),
            OwnerID:    uuidToString(row.OwnerID),
            Status:     note.NoteStatus(row.Status),
            CreatedAt:  timestamptzToTime(row.CreatedAt),
            UpdatedAt:  timestamptzToTime(row.UpdatedAt),
        },
        TemplateName:   row.TemplateName,
        OwnerFirstName: row.FirstName,
        OwnerLastName:  row.LastName,
        OwnerThumbnail: thumbnail,
        Sections:       sections,
    }, nil
}
```

#### â‘§ Presenter

```go
// internal/adapter/http/presenter/note_presenter.go
func (p *NotePresenter) PresentNote(_ context.Context, n *note.WithMeta) error {
    // ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ« â†’ OpenAPIå‹ã«å¤‰æ›
    resp := toNoteResponse(*n)
    p.note = &resp  // çµæœã‚’ä¿å­˜
    return nil
}

func toNoteResponse(n note.WithMeta) openapi.ModelsNoteResponse {
    sections := make([]openapi.ModelsSection, 0, len(n.Sections))
    for _, s := range n.Sections {
        sections = append(sections, openapi.ModelsSection{
            Id:         s.Section.ID,
            FieldId:    s.Section.FieldID,
            FieldLabel: s.FieldLabel,
            Content:    s.Section.Content,
            IsRequired: s.IsRequired,
        })
    }

    return openapi.ModelsNoteResponse{
        Id:           n.Note.ID,
        Title:        n.Note.Title,
        TemplateId:   n.Note.TemplateID,
        TemplateName: n.TemplateName,
        OwnerId:      n.Note.OwnerID,
        Owner: openapi.ModelsAccountSummary{
            Id:        n.Note.OwnerID,
            FirstName: n.OwnerFirstName,
            LastName:  n.OwnerLastName,
            Thumbnail: n.OwnerThumbnail,
        },
        Status:    openapi.ModelsNoteStatus(n.Note.Status),
        Sections:  sections,
        CreatedAt: n.Note.CreatedAt,
        UpdatedAt: n.Note.UpdatedAt,
    }
}
```

### ğŸ”„ ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›ã®æµã‚Œ

```
HTTP Request (JSON)
    â”‚
    â”‚ {"id": "123"}
    â†“
Controller: string "123"
    â”‚
    â”‚ noteID: string
    â†“
UseCase: string "123"
    â”‚
    â”‚ id: string
    â†“
Repository: pgtype.UUID
    â”‚
    â”‚ SELECT * FROM notes WHERE id = $1
    â†“
PostgreSQL: Row
    â”‚
    â”‚ {id: uuid, title: text, ...}
    â†“
Repository: note.WithMeta (Domain)
    â”‚
    â”‚ Note{ID: string, Title: string, ...}
    â†“
UseCase: note.WithMeta
    â”‚
    â”‚ æ¸¡ã™ã ã‘
    â†“
Presenter: openapi.ModelsNoteResponse
    â”‚
    â”‚ {id: string, title: string, ...}
    â†“
Controller: HTTP Response (JSON)
    â”‚
    â”‚ {"id": "123", "title": "..."}
    â†“
HTTP Response
```

---

## Factoryã£ã¦ä½•ï¼Ÿ

Factoryã¯**ã€Œå·¥å ´ã€**ã§ã™ã€‚

### ğŸ­ ä¾‹ãˆ: ãŠã‚‚ã¡ã‚ƒå·¥å ´

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ğŸ­ ãŠã‚‚ã¡ã‚ƒå·¥å ´              â”‚
â”‚                                 â”‚
â”‚  è¨­è¨ˆå›³ã‚’è¦‹ã¦ã€æ¯å›æ–°ã—ã„        â”‚
â”‚  ãŠã‚‚ã¡ã‚ƒã‚’ä½œã‚‹                  â”‚
â”‚                                 â”‚
â”‚  è¨­è¨ˆå›³:                         â”‚
â”‚  - è»Šã®ãŠã‚‚ã¡ã‚ƒã®ä½œã‚Šæ–¹          â”‚
â”‚  - äººå½¢ã®ä½œã‚Šæ–¹                  â”‚
â”‚  - ãƒ–ãƒ­ãƒƒã‚¯ã®ä½œã‚Šæ–¹              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å·¥å ´ã®ä»•äº‹:**
1. æ³¨æ–‡ãŒæ¥ã‚‹ã€Œè»Šã®ãŠã‚‚ã¡ã‚ƒ1ã¤ãã ã•ã„ã€
2. è¨­è¨ˆå›³ã‚’è¦‹ã‚‹
3. **æ–°ã—ã„**ãŠã‚‚ã¡ã‚ƒã‚’ä½œã‚‹
4. æ¸¡ã™

### ğŸ’» ãªãœFactoryãŒå¿…è¦ï¼Ÿ

#### âŒ Factoryãªã—ã®å ´åˆ

```go
// âŒ æ‚ªã„ä¾‹: èµ·å‹•æ™‚ã«1ã¤ã ã‘ä½œã‚‹
func main() {
    // èµ·å‹•æ™‚ã«1ã¤ã ã‘Presenterã‚’ä½œã‚‹
    presenter := &NotePresenter{}

    // å…¨ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§åŒã˜Presenterã‚’ä½¿ã„å›ã™
    controller := &NoteController{
        presenter: presenter,  // â† ä½¿ã„å›ã—
    }

    // ãƒªã‚¯ã‚¨ã‚¹ãƒˆ1
    // presenter.note = ãƒãƒ¼ãƒˆA
    // ãƒªã‚¯ã‚¨ã‚¹ãƒˆ2
    // presenter.note = ãƒãƒ¼ãƒˆB  â† ä¸Šæ›¸ãï¼
    // ãƒªã‚¯ã‚¨ã‚¹ãƒˆ1ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹
    // return presenter.note  â† ãƒãƒ¼ãƒˆBãŒè¿”ã‚‹ï¼ãƒã‚°ï¼
}
```

#### âœ… Factoryã‚ã‚Šã®å ´åˆ

```go
// âœ… è‰¯ã„ä¾‹: ãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ã«æ–°ã—ã„Presenterã‚’ä½œã‚‹
type NoteController struct {
    // å·¥å ´ï¼ˆè¨­è¨ˆå›³ï¼‰ã‚’ä¿å­˜
    presenterFactory func() *NotePresenter
}

func (c *NoteController) GetByID(ctx echo.Context, noteID string) error {
    // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ã«æ–°ã—ã„Presenterã‚’ä½œã‚‹
    presenter := c.presenterFactory()  // â† å·¥å ´ã‚’å‘¼ã¶

    // ã“ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆå°‚ç”¨ã®Presenterã ã‹ã‚‰å®‰å…¨
    // presenter.note = ãƒãƒ¼ãƒˆA
    // return presenter.note  // ãƒãƒ¼ãƒˆAãŒè¿”ã‚‹
}
```

### ğŸ”§ Factoryã®å®Ÿè£…

```go
// â‘  å·¥å ´ã®å®šç¾©
// internal/driver/factory/presenter_factory.go
func NewNotePresenterFactory() func() *presenter.NotePresenter {
    return func() *presenter.NotePresenter {
        // æ–°ã—ã„Presenterã‚’ä½œã‚‹
        return presenter.NewNotePresenter()
    }
}

// â‘¡ Controllerã«å·¥å ´ã‚’æ¸¡ã™
// internal/driver/initializer/api/initializer.go
func BuildServer(ctx context.Context) (*echo.Echo, func(), error) {
    // ...

    // å·¥å ´ã‚’ä½œã‚‹
    presenterFactory := factory.NewNotePresenterFactory()

    // Controllerã«å·¥å ´ã‚’æ¸¡ã™ï¼ˆãŠã‚‚ã¡ã‚ƒæœ¬ä½“ã˜ã‚ƒãªãã¦ã€è¨­è¨ˆå›³ã‚’æ¸¡ã™ï¼‰
    noteCtrl := controller.NewNoteController(
        noteInputFactory,
        presenterFactory,  // â† è¨­è¨ˆå›³
        noteRepoFactory,
        tplRepoFactory,
        txFactory,
    )

    // ...
}

// â‘¢ Controllerã¯å·¥å ´ã‚’ä¿å­˜
type NoteController struct {
    presenterFactory func() *presenter.NotePresenter  // â† è¨­è¨ˆå›³ã‚’ä¿å­˜
}

// â‘£ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ã«å·¥å ´ã‚’å‘¼ã¶
func (c *NoteController) GetByID(ctx echo.Context, noteID string) error {
    // å·¥å ´ã‚’å‘¼ã‚“ã§æ–°ã—ã„Presenterã‚’ä½œã‚‹
    presenter := c.presenterFactory()  // â† æ–°ã—ã„ãŠã‚‚ã¡ã‚ƒã‚’ä½œã‚‹

    // ...
}
```

---

## ã©ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒã©ã“ã‚’å‘¼ã¶ã®ã‹

### ğŸ“Š å‘¼ã³å‡ºã—é–¢ä¿‚ã®å…¨ä½“å›³

```
main.go
  â”‚
  â”‚ BuildServer()
  â†“
Initializer
  â”‚
  â”‚ NewXxxFactory() ã§å·¥å ´ã‚’ä½œã‚‹
  â”‚ NewXxxController() ã§Controllerã‚’ä½œã‚‹
  â†“
Controller
  â”‚
  â”‚ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ã«:
  â”‚ 1. Factory ã‚’å‘¼ã¶ â†’ UseCase ã¨ Presenter ã‚’ä½œã‚‹
  â”‚ 2. UseCase.Get() ã‚’å‘¼ã¶
  â”‚ 3. Presenter.Note() ã§çµæœã‚’å–å¾—
  â†“
UseCase (Interactor)
  â”‚
  â”‚ 1. Repository.Get() ã‚’å‘¼ã¶ï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹çµŒç”±ï¼‰
  â”‚ 2. Presenter.PresentNote() ã‚’å‘¼ã¶ï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹çµŒç”±ï¼‰
  â†“
Repository          Presenter
  â”‚                   â”‚
  â”‚ DBå•ã„åˆã‚ã›      â”‚ çµæœã‚’ä¿å­˜
  â†“                   â†“
PostgreSQL          å†…éƒ¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
```

### ğŸ” è©³ç´°ãªå‘¼ã³å‡ºã—ãƒã‚§ãƒ¼ãƒ³

#### 1. ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚

```
main()
  â†’ BuildServer()
    â†’ NewPool() (DBæ¥ç¶š)
    â†’ NewNoteInputFactory() (å·¥å ´ã‚’ä½œã‚‹)
    â†’ NewNotePresenterFactory() (å·¥å ´ã‚’ä½œã‚‹)
    â†’ NewNoteRepositoryFactory() (å·¥å ´ã‚’ä½œã‚‹)
    â†’ NewTxFactory() (å·¥å ´ã‚’ä½œã‚‹)
    â†’ NewNoteController(å·¥å ´ãŸã¡ã‚’æ¸¡ã™)
    â†’ NewServer(ControllerãŸã¡ã‚’æ¸¡ã™)
    â†’ Echoèµ·å‹•
```

**ãƒã‚¤ãƒ³ãƒˆ:**
- èµ·å‹•æ™‚ã¯**å·¥å ´ã‚’ä½œã‚‹ã ã‘**
- å®Ÿéš›ã®UseCase/Presenter/Repositoryã¯**ã¾ã ä½œã‚‰ãªã„**

#### 2. ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡æ™‚

```
Echo ãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡
  â†’ ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç¢ºèª
  â†’ NoteController.GetByID() ã‚’å‘¼ã¶
```

#### 3. Controllerå†…éƒ¨

```
NoteController.GetByID(ctx, noteID)
  â”‚
  â”‚ ã“ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆå°‚ç”¨ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œã‚‹
  â†“
newIO() ã‚’å‘¼ã¶
  â”‚
  â”œâ”€ outputFactory() â†’ æ–°ã—ã„Presenterã‚’ä½œã‚‹
  â”‚
  â”œâ”€ noteRepoFactory() â†’ æ–°ã—ã„Repositoryã‚’ä½œã‚‹
  â”‚
  â”œâ”€ tplRepoFactory() â†’ æ–°ã—ã„Repositoryã‚’ä½œã‚‹
  â”‚
  â”œâ”€ txFactory() â†’ æ–°ã—ã„TxManagerã‚’ä½œã‚‹
  â”‚
  â””â”€ inputFactory(repos..., output) â†’ æ–°ã—ã„UseCaseã‚’ä½œã‚‹
       â”‚
       â””â”€ UseCase ã« Repository ã¨ Presenter ã‚’æ³¨å…¥
  â”‚
  â†“
input.Get(ctx, noteID) ã‚’å‘¼ã¶
  â”‚
  â†“
p.Note() ã§çµæœã‚’å–å¾—
  â”‚
  â†“
ctx.JSON(200, result) ã§HTTPãƒ¬ã‚¹ãƒãƒ³ã‚¹
```

#### 4. UseCaseå†…éƒ¨

```
NoteInteractor.Get(ctx, id)
  â”‚
  â”œâ”€ u.notes.Get(ctx, id) â†’ Repository ã‚’å‘¼ã¶
  â”‚    â”‚
  â”‚    â””â”€ PostgreSQLå•ã„åˆã‚ã›
  â”‚         DBè¡Œ â†’ ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã«å¤‰æ›
  â”‚         return note.WithMeta
  â”‚
  â”œâ”€ u.output.PresentNote(ctx, note) â†’ Presenter ã‚’å‘¼ã¶
  â”‚    â”‚
  â”‚    â””â”€ ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ« â†’ OpenAPIå‹ã«å¤‰æ›
  â”‚         p.note = result (ä¿å­˜)
  â”‚
  â””â”€ return nil
```

#### 5. Controller ã«æˆ»ã‚‹

```
Controller
  â”‚
  â”œâ”€ input.Get() ãŒå®Œäº†
  â”‚
  â”œâ”€ p.Note() ã§çµæœã‚’å–å¾—
  â”‚    â”‚
  â”‚    â””â”€ PresenterãŒä¿å­˜ã—ã¦ã„ãŸçµæœã‚’è¿”ã™
  â”‚
  â””â”€ ctx.JSON(200, result)
       â”‚
       â””â”€ Echo ãŒ HTTPãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦è¿”ã™
```

### ğŸ¯ é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ

```
âœ… èµ·å‹•æ™‚:
   å·¥å ´ã‚’ä½œã‚‹ï¼ˆè¨­è¨ˆå›³ã‚’ç”¨æ„ï¼‰
   â†“
   Controllerã«å·¥å ´ã‚’æ¸¡ã™
   â†“
   å¾…æ©Ÿ

âœ… ãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨:
   å·¥å ´ã‚’å‘¼ã¶
   â†“
   æ–°ã—ã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œã‚‹ï¼ˆUseCaseã€Presenterã€Repositoryï¼‰
   â†“
   UseCaseã«ä¾å­˜ã‚’æ³¨å…¥
   â†“
   å‡¦ç†
   â†“
   çµæœã‚’è¿”ã™
   â†“
   ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ç ´æ£„ï¼ˆæ¬¡ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã¾ãŸæ–°ã—ãä½œã‚‹ï¼‰
```

---

## ğŸ“ ã¾ã¨ã‚

### åŒå¿ƒå††ã®å›³ã®æœ¬è³ª

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¤–å´: å¤‰ã‚ã‚Šã‚„ã™ã„ã‚‚ã®               â”‚
â”‚  - DB (PostgreSQL â†’ MySQL)           â”‚
â”‚  - Web (Echo â†’ Gin)                  â”‚
â”‚  - API (REST â†’ GraphQL)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ å½±éŸ¿ã‚’å—ã‘ãªã„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å†…å´: å¤‰ã‚ã‚Šã«ãã„ã‚‚ã®               â”‚
â”‚  - ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«                     â”‚
â”‚  - ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å‡¦ç†ã®æµã‚Œã®æœ¬è³ª

```
1. Controller: å¤–ã®ä¸–ç•Œ â†’ å†…ã®ä¸–ç•Œã«å¤‰æ›
2. UseCase: æ‰‹é †æ›¸é€šã‚Šã«å‡¦ç†
3. Repository: å†…ã®ä¸–ç•Œ â†’ DBã«å¤‰æ›
4. Presenter: å†…ã®ä¸–ç•Œ â†’ å¤–ã®ä¸–ç•Œã«å¤‰æ›
```

### ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®æœ¬è³ª

```
ç´„æŸäº‹ã ã‘æ±ºã‚ã¦ãŠã‘ã°ã€å®Ÿè£…ã¯ç°¡å˜ã«å·®ã—æ›¿ãˆã‚‰ã‚Œã‚‹
â†’ ãƒ†ã‚¹ãƒˆç°¡å˜ã€DBå¤‰æ›´ç°¡å˜ã€ä¿å®ˆç°¡å˜
```

### Factoryã®æœ¬è³ª

```
ãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ã«æ–°ã—ã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œã‚‹ã“ã¨ã§ã€
çŠ¶æ…‹ãŒæ··ã–ã‚‰ãªã„ã€å®‰å…¨ãªä¸¦è¡Œå‡¦ç†ãŒã§ãã‚‹
```

---

## ğŸ’¡ ã‚ˆãã‚ã‚‹è³ªå•ã¨ç­”ãˆ

### Q1: ãªã‚“ã§ã“ã‚“ãªã«è¤‡é›‘ã«ã™ã‚‹ã®ï¼Ÿã‚·ãƒ³ãƒ—ãƒ«ã˜ã‚ƒãƒ€ãƒ¡ãªã®ï¼Ÿ

**A:** å°ã•ã„ã‚¢ãƒ—ãƒªãªã‚‰ç¢ºã‹ã«ã‚ªãƒ¼ãƒãƒ¼ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã§ã™ã€‚ã§ã‚‚ï¼š

```
å°è¦æ¨¡ (1äººã€1ãƒ¶æœˆ):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   main.go    â”‚
â”‚  å…¨éƒ¨ã“ã“ï¼  â”‚ â† ã“ã‚Œã§OK
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¸­ã€œå¤§è¦æ¨¡ (ãƒãƒ¼ãƒ ã€é•·æœŸä¿å®ˆ):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£            â”‚
â”‚  ãƒ»ãƒ†ã‚¹ãƒˆã—ã‚„ã™ã„                  â”‚
â”‚  ãƒ»å¤‰æ›´ã«å¼·ã„                      â”‚
â”‚  ãƒ»ãƒãƒ¼ãƒ é–‹ç™ºã—ã‚„ã™ã„               â”‚
â”‚  ãƒ»ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯å¤‰æ›´ã§ãã‚‹         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯æ•™æãªã®ã§ã€ã‚ã–ã¨ä¸å¯§ã«åˆ†ã‘ã¦ã„ã¾ã™ã€‚**

---

### Q2: ã©ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ãƒ†ã‚¹ãƒˆã‚’æ›¸ã‘ã°ã„ã„ï¼Ÿ

**A:** å…¨éƒ¨ï¼ã§ã‚‚å„ªå…ˆé †ä½ã¯ï¼š

```
æœ€å„ªå…ˆ: â­â­â­
â”œâ”€ Domain (ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«)
â”‚  â†’ ã“ã“ãŒå£Šã‚ŒãŸã‚‰è‡´å‘½çš„ï¼
â”‚
â”œâ”€ UseCase (æ‰‹é †)
â”‚  â†’ ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ
â”‚
æ¬¡ç‚¹: â­â­
â”œâ”€ Presenter (å¤‰æ›)
â”‚  â†’ ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ãŒæ­£ã—ã„ã‹
â”‚
â”œâ”€ Gateway (DBå¤‰æ›)
â”‚  â†’ ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«å¤‰æ›ãŒæ­£ã—ã„ã‹
â”‚
æœ€å¾Œ: â­
â””â”€ Controller (HTTPãƒãƒ³ãƒ‰ãƒ©)
   â†’ çµåˆãƒ†ã‚¹ãƒˆã‚„E2Eã§ç¢ºèª
```

---

### Q3: Repositoryã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯ã©ã“ã«ç½®ãï¼Ÿ

**A:** ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ **Portï¼ˆ`internal/port`ï¼‰** ã«ç½®ã„ã¦ã„ã¾ã™ã€‚

```
Option A: Portã«ç½®ã (ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   port/        â”‚
â”‚  - NoteRepository interface
â”‚  - TemplateRepository interface
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘
         â”‚ å®Ÿè£…ï¼ˆORMåˆ¥ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ gateway/db/sqlc/     â”‚  â† sqlcå®Ÿè£…
â”‚  - NoteRepository struct
â”‚ gateway/db/gorm/    â”‚  â† GORMå®Ÿè£…ï¼ˆæº–å‚™æ¸ˆã¿ï¼‰
â”‚  - AccountRepository struct
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Option B: Domainã«ç½®ã
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  domain/note/  â”‚
â”‚  - Note entity
â”‚  - NoteRepository interface  â† ã“ã“
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã©ã£ã¡ã§ã‚‚OKï¼ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§æ±ºã‚ã‚ˆã†ã€‚
```

---

### Q4: ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¯ã©ã“ã§å§‹ã‚ã‚‹ï¼Ÿ

**A:** **UseCase ã§é–‹å§‹**ã—ã¾ã™ã€‚

```go
func (u *NoteInteractor) Create(ctx context.Context, input port.NoteCreateInput) error {
    // âœ… UseCaseã§ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹
    err := u.tx.WithinTransaction(ctx, func(txCtx context.Context) error {
        // ã“ã®ä¸­ã§è¤‡æ•°ã®Repositoryã‚’å‘¼ã¶
        note, err := u.notes.Create(txCtx, ...)
        if err != nil {
            return err  // è‡ªå‹•ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
        }

        err = u.notes.ReplaceSections(txCtx, ...)
        if err != nil {
            return err  // è‡ªå‹•ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
        }

        return nil  // æ­£å¸¸çµ‚äº† â†’ ã‚³ãƒŸãƒƒãƒˆ
    })
    return err
}
```

**ãªãœï¼Ÿ**
- **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®å¢ƒç•Œ = ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®å¢ƒç•Œ**
- Repositoryã¯ã€Œãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚‹ãƒ»ä¿å­˜ã™ã‚‹ã€ã ã‘ã«é›†ä¸­

---

### Q5: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¯ã©ã†ã™ã‚‹ï¼Ÿ

```
ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼ (internal/domain/errors/)
    â†“
ErrNotFound, ErrUnauthorized, ErrTitleRequired...
    â†“
Controller (handleErroré–¢æ•°)
    â†“
HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã«å¤‰æ›
    â†“
404 Not Found, 401 Unauthorized, 400 Bad Request
```

**é‡è¦:** Gatewayã§**DBã‚¨ãƒ©ãƒ¼ â†’ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼**ã«å¤‰æ›ã™ã‚‹ï¼

```go
// âŒ NG: pgx.ErrNoRowsã‚’ãã®ã¾ã¾è¿”ã™
if err != nil {
    return nil, err
}

// âœ… OK: ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼ã«å¤‰æ›
if errors.Is(err, pgx.ErrNoRows) {
    return nil, domainerr.ErrNotFound
}
```

---

### Q6: HTTPã¨gRPCã‚’ä¸¡æ–¹ã‚µãƒãƒ¼ãƒˆã™ã‚‹å ´åˆã®è¨­è¨ˆã¯ï¼Ÿ

**A:** **ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯HTTPã¨gRPCã®ä¸¡æ–¹ã‚’ã‚µãƒãƒ¼ãƒˆ**ã—ã¦ã„ã¾ã™ã€‚

```
UseCase (ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯) - 1ã¤ã ã‘
    â†‘                    â†‘
    â”‚                    â”‚
HTTP Presenter      gRPC Presenter
HTTP Controller     gRPC Controller
    â†“                    â†“
REST API            gRPC API
```

**ãƒã‚¤ãƒ³ãƒˆ:**
- UseCaseã¯1ã¤ã ã‘ï¼ˆå…±é€šã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
- Presenter/Controllerã‚’ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã”ã¨ã«ç”¨æ„
- Factoryã‚‚ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã”ã¨ã«åˆ†ã‘ã‚‹ï¼ˆ`factory/http/`ã€`factory/grpc/`ï¼‰

```go
// HTTP Presenterã®ä¾‹
// internal/adapter/http/presenter/account_presenter.go
func (p *AccountPresenter) PresentAccount(ctx context.Context, acc *account.Account) error {
    // OpenAPIå‹ã«å¤‰æ›
    p.account = toOpenAPIAccount(acc)
    return nil
}

// gRPC Presenterã®ä¾‹
// internal/adapter/grpc/presenter/account_presenter.go
func (p *AccountPresenter) PresentAccount(ctx context.Context, acc *account.Account) error {
    // Protobufå‹ã«å¤‰æ›
    p.response = toProtobufAccount(acc)
    return nil
}
```

**ãƒ¡ãƒªãƒƒãƒˆ:**
- ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’é‡è¤‡ã•ã›ãªã„
- ãƒ—ãƒ­ãƒˆã‚³ãƒ«å›ºæœ‰ã®å¤‰æ›ã¯å„Adapterã§å¸å
- ãƒ†ã‚¹ãƒˆã‚‚å…±é€šåŒ–ã§ãã‚‹

---

### Q7: ORMã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã«ã¯ã©ã†ã™ã‚‹ï¼Ÿ

**A:** **ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ORMåˆ‡ã‚Šæ›¿ãˆã«å¯¾å¿œ**ã—ã¦ã„ã¾ã™ã€‚

ç¾åœ¨ã®æ§‹æˆ:
```
internal/adapter/gateway/db/
â”œâ”€â”€ sqlc/              # sqlcå®Ÿè£…ï¼ˆç¾åœ¨ä½¿ç”¨ä¸­ï¼‰
â”‚   â”œâ”€â”€ account_repository.go
â”‚   â”œâ”€â”€ note_repository.go
â”‚   â””â”€â”€ template_repository.go
â””â”€â”€ gorm/              # GORMå®Ÿè£…ï¼ˆæº–å‚™æ¸ˆã¿ï¼‰
    â””â”€â”€ account_repository.go
```

**åˆ‡ã‚Šæ›¿ãˆæ‰‹é †ï¼ˆ3ã‚¹ãƒ†ãƒƒãƒ—ï¼‰:**

1. **importæ–‡ã®åˆ‡ã‚Šæ›¿ãˆ**
   ```go
   // internal/driver/factory/repository_factory.go
   import (
       "github.com/jackc/pgx/v5/pgxpool"

       "immortal-architecture-clean/backend/internal/adapter/gateway/db/sqlc"
       // "immortal-architecture-clean/backend/internal/adapter/gateway/db/gorm"  â† ã‚³ãƒ¡ãƒ³ãƒˆå¤–ã™
       "immortal-architecture-clean/backend/internal/port"
   )
   ```

2. **Factoryé–¢æ•°ã®ä¿®æ­£**
   ```go
   func NewAccountRepoFactory(pool *pgxpool.Pool) func() port.AccountRepository {
       return func() port.AccountRepository {
           // Current: sqlcå®Ÿè£…
           return sqlc.NewAccountRepository(pool)

           // To switch to GORM, replace above with:
           // return gorm.NewAccountRepository(db)
       }
   }
   ```

3. **DBæ¥ç¶šã®å¤‰æ›´**ï¼ˆsqlcç”¨ã®poolã‹ã‚‰GORMç”¨ã®dbã¸ï¼‰
   ```go
   // internal/driver/initializer/api/initializer.go
   // pool, err := driverdb.NewPool(ctx, cfg.DatabaseURL)  // sqlcç”¨
   db, err := gorm.Open(postgres.Open(cfg.DatabaseURL))   // GORMç”¨
   ```

**é‡è¦:**
- **Domainã€UseCaseã€Controllerã€Presenterã¯å¤‰æ›´ä¸è¦**
- Gatewayå±¤ã ã‘å·®ã—æ›¿ãˆã‚Œã°OK
- ã“ã‚ŒãŒã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å¤‰æ›´å¯èƒ½æ€§ï¼

---

## âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ: ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå‰ã«

æ–°ã—ã„æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹å‰ã«ã€ã“ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’ç¢ºèªã—ã‚ˆã†ï¼

### âœ… Domainå±¤

- [ ] ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚„å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«**ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®å‹**ã‚’ä½¿ã£ã¦ã„ãªã„ã‹ï¼Ÿ
- [ ] ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ï¼ˆæ¤œè¨¼ã€çŠ¶æ…‹é·ç§»ï¼‰ã‚’**ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤**ã«æ›¸ã„ã¦ã„ã‚‹ã‹ï¼Ÿ
- [ ] `import "github.com/..."` ãªã©ã®å¤–éƒ¨ä¾å­˜ãŒãªã„ã‹ï¼Ÿ

### âœ… UseCaseå±¤

- [ ] Portï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼‰çµŒç”±ã§ä¾å­˜ã—ã¦ã„ã‚‹ã‹ï¼Ÿ
- [ ] å…·ä½“çš„ãªå®Ÿè£…ï¼ˆ`&db.Repository{}`ï¼‰ã«ä¾å­˜ã—ã¦ã„ãªã„ã‹ï¼Ÿ
- [ ] ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œã‚’é©åˆ‡ã«æ±ºã‚ã¦ã„ã‚‹ã‹ï¼Ÿ
- [ ] 1ãƒ¡ã‚½ãƒƒãƒ‰ = 1ä»•äº‹ã«ãªã£ã¦ã„ã‚‹ã‹ï¼Ÿ

### âœ… Controllerå±¤

- [ ] HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆ â†’ ãƒ‰ãƒ¡ã‚¤ãƒ³DTOã«å¤‰æ›ã—ã¦ã„ã‚‹ã‹ï¼Ÿ
- [ ] UseCaseã‚’å‘¼ã‚“ã§ã€Presenterã‹ã‚‰çµæœã‚’å–å¾—ã—ã¦ã„ã‚‹ã‹ï¼Ÿ
- [ ] ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ›¸ã„ã¦ã„ãªã„ã‹ï¼Ÿï¼ˆUseCaseã«æ›¸ãï¼‰

### âœ… Presenterå±¤

- [ ] ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ« â†’ OpenAPIå‹ã«å¤‰æ›ã—ã¦ã„ã‚‹ã‹ï¼Ÿ
- [ ] çµæœã‚’å†…éƒ¨ã§ä¿å­˜ã—ã¦ã€ControllerãŒå–ã‚Šå‡ºã›ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹ã‹ï¼Ÿ

### âœ… Gatewayå±¤

- [ ] DBè¡Œ â†’ ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã«å¤‰æ›ã—ã¦ã„ã‚‹ã‹ï¼Ÿ
- [ ] DBã‚¨ãƒ©ãƒ¼ â†’ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼ã«å¤‰æ›ã—ã¦ã„ã‚‹ã‹ï¼Ÿ
- [ ] `pgtype.UUID` â†’ `string` ãªã©ã®å‹å¤‰æ›ã‚’ã—ã¦ã„ã‚‹ã‹ï¼Ÿ

### âœ… Portå±¤

- [ ] InputPort, OutputPort, Repositoryã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©ã—ã¦ã„ã‚‹ã‹ï¼Ÿ
- [ ] å…¥åŠ›DTOã‚’å®šç¾©ã—ã¦ã„ã‚‹ã‹ï¼Ÿ

---

## ğŸ“ ä»˜éŒ²: ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã®å…¨ä½“åƒ

```
backend-clean/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ main.go                      # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ domain/                          # â¤ï¸ ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«
â”‚   â”‚   â”œâ”€â”€ note/
â”‚   â”‚   â”‚   â”œâ”€â”€ entity.go                # Note, Section
â”‚   â”‚   â”‚   â”œâ”€â”€ types.go                 # NoteStatus
â”‚   â”‚   â”‚   â”œâ”€â”€ logic.go                 # æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”‚   â”œâ”€â”€ aggregate.go             # WithMeta
â”‚   â”‚   â”‚   â””â”€â”€ *_test.go
â”‚   â”‚   â”œâ”€â”€ template/
â”‚   â”‚   â”œâ”€â”€ account/
â”‚   â”‚   â”œâ”€â”€ service/                     # ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚   â”‚   â”œâ”€â”€ note_lifecycle.go        # BuildNote
â”‚   â”‚   â”‚   â”œâ”€â”€ status_transition.go     # CanPublish
â”‚   â”‚   â”‚   â””â”€â”€ build_sections_from_template.go
â”‚   â”‚   â””â”€â”€ errors/
â”‚   â”‚       â””â”€â”€ errors.go                # ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼å®šç¾©
â”‚   â”‚
â”‚   â”œâ”€â”€ usecase/                         # ğŸ¯ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ note_interactor.go
â”‚   â”‚   â”œâ”€â”€ template_interactor.go
â”‚   â”‚   â”œâ”€â”€ account_interactor.go
â”‚   â”‚   â””â”€â”€ mock/
â”‚   â”‚
â”‚   â”œâ”€â”€ port/                            # ğŸ“ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”‚   â”‚   â”œâ”€â”€ note_port.go
â”‚   â”‚   â”œâ”€â”€ template_port.go
â”‚   â”‚   â”œâ”€â”€ account_port.go
â”‚   â”‚   â””â”€â”€ tx.go
â”‚   â”‚
â”‚   â”œâ”€â”€ adapter/                         # ğŸ”Œ å¤–éƒ¨ã¨ã®æ¥ç¶š
â”‚   â”‚   â”œâ”€â”€ http/
â”‚   â”‚   â”‚   â”œâ”€â”€ controller/              # HTTPãƒãƒ³ãƒ‰ãƒ©
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ note_controller.go
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ template_controller.go
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ account_controller.go
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ server.go            # ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ mock/
â”‚   â”‚   â”‚   â”œâ”€â”€ presenter/               # ãƒ¬ã‚¹ãƒãƒ³ã‚¹å¤‰æ›
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ note_presenter.go
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ template_presenter.go
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ account_presenter.go
â”‚   â”‚   â”‚   â””â”€â”€ generated/
â”‚   â”‚   â”‚       â””â”€â”€ openapi/             # OpenAPIç”Ÿæˆç‰©
â”‚   â”‚   â”‚           â””â”€â”€ server.gen.go
â”‚   â”‚   â”œâ”€â”€ grpc/
â”‚   â”‚   â”‚   â”œâ”€â”€ controller/              # gRPCãƒãƒ³ãƒ‰ãƒ©
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ account_controller.go
â”‚   â”‚   â”‚   â”œâ”€â”€ presenter/               # gRPCãƒ¬ã‚¹ãƒãƒ³ã‚¹å¤‰æ›
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ account_presenter.go
â”‚   â”‚   â”‚   â””â”€â”€ generated/
â”‚   â”‚   â”‚       â””â”€â”€ accountpb/           # protobufç”Ÿæˆç‰©
â”‚   â”‚   â””â”€â”€ gateway/
â”‚   â”‚       â”œâ”€â”€ db/                      # DB Repository
â”‚   â”‚       â”‚   â”œâ”€â”€ sqlc/                # sqlcå®Ÿè£…
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ note_repository.go
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ template_repository.go
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ account_repository.go
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ generated/       # sqlcç”Ÿæˆç‰©
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ queries/         # SQLã‚¯ã‚¨ãƒª
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ mock/
â”‚   â”‚       â”‚   â””â”€â”€ gorm/                # GORMå®Ÿè£…ï¼ˆæº–å‚™æ¸ˆã¿ï¼‰
â”‚   â”‚       â”‚       â””â”€â”€ account_repository.go
â”‚   â”‚       â””â”€â”€ externalapi/             # å¤–éƒ¨API (å°†æ¥ç”¨)
â”‚   â”‚
â”‚   â””â”€â”€ driver/                          # ğŸ”§ é…ç·šãƒ»åˆæœŸåŒ–
â”‚       â”œâ”€â”€ config/                      # è¨­å®š
â”‚       â”œâ”€â”€ db/                          # DBæ¥ç¶š
â”‚       â”‚   â”œâ”€â”€ pool.go
â”‚       â”‚   â””â”€â”€ tx.go
â”‚       â”œâ”€â”€ factory/                     # Factoryé–¢æ•°
â”‚       â”‚   â”œâ”€â”€ usecase_factory.go
â”‚       â”‚   â”œâ”€â”€ repository_factory.go    # ORMåˆ‡ã‚Šæ›¿ãˆãƒã‚¤ãƒ³ãƒˆ
â”‚       â”‚   â”œâ”€â”€ tx_factory.go
â”‚       â”‚   â”œâ”€â”€ http/                    # HTTPå°‚ç”¨Factory
â”‚       â”‚   â”‚   â””â”€â”€ presenter_factory.go
â”‚       â”‚   â””â”€â”€ grpc/                    # gRPCå°‚ç”¨Factory
â”‚       â”‚       â””â”€â”€ presenter_factory.go
â”‚       â””â”€â”€ initializer/
â”‚           â”œâ”€â”€ api/
â”‚           â”‚   â””â”€â”€ initializer.go       # HTTP APIçµ„ã¿ç«‹ã¦
â”‚           â””â”€â”€ grpc/
â”‚               â””â”€â”€ initializer.go       # gRPCã‚µãƒ¼ãƒãƒ¼çµ„ã¿ç«‹ã¦
â”‚
â”œâ”€â”€ migrations/                          # DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â”œâ”€â”€ docs/                                # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â””â”€â”€ tests/                               # E2Eãƒ†ã‚¹ãƒˆ (å°†æ¥ç”¨)
```

---

## ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ã“ã®å‡¦ç†ã®æµã‚Œã‚’ç†è§£ã—ãŸã‚‰ã€æ¬¡ã¯å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚“ã§ã¿ã¾ã—ã‚‡ã†ï¼š

1. **[01_why_clean_architecture.md](./01_why_clean_architecture.md)** - ãªãœå¿…è¦ã‹ç†è§£ã™ã‚‹
2. **å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚€** - `internal/adapter/http/controller/note_controller.go` ã‹ã‚‰å§‹ã‚ã‚‹
3. **[04_testing_guide.md](./04_testing_guide.md)** - ãƒ†ã‚¹ãƒˆã®æ›¸ãæ–¹ã‚’å­¦ã¶
4. **ãƒ‡ãƒãƒƒã‚¬ãƒ¼ã§è¿½ã„ã‹ã‘ã‚‹** - å®Ÿéš›ã«å‹•ã‹ã—ã¦ç¢ºèªã™ã‚‹

**Happy Learning!** ğŸ‰
